"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var dbpromise=void 0,DBHelper=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"openDatabase",value:function(){return idb.open("restaurantDb",1,function(e){e.createObjectStore("restaurantDb",{keyPath:"id"})})}},{key:"saveDatabase",value:function(r){return n.openDatabase().then(function(e){if(e){var t=e.transaction("restaurantDb","readwrite"),n=t.objectStore("restaurantDb");return r.forEach(function(e){n.put(e)}),t.complete}})}},{key:"getCachedDb",value:function(){return(dbpromise=n.openDatabase()).then(function(e){if(e)return e.transaction("restaurantDb").objectStore("restaurantDb").getAll()})}},{key:"fromApi",value:function(){return fetch(n.DATABASE_URL).then(function(e){return e.json()}).then(function(e){return n.saveDatabase(e),e})}},{key:"fetchRestaurants",value:function(t){return n.getCachedDb().then(function(e){return e.length?Promise.resolve(e):n.fromApi()}).then(function(e){t(null,e)}).catch(function(e){t(e,null)})}},{key:"fetchRestaurantById",value:function(r,a){n.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.find(function(e){return e.id==r});n?a(null,n):a("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,a){n.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.cuisine_type==r});a(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,a){n.fetchRestaurants(function(e,t){if(e)a(e,null);else{var n=t.filter(function(e){return e.neighborhood==r});a(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,a,i){n.fetchRestaurants(function(e,t){if(e)i(e,null);else{var n=t;"all"!=r&&(n=n.filter(function(e){return e.cuisine_type==r})),"all"!=a&&(n=n.filter(function(e){return e.neighborhood==a})),i(null,n)}})}},{key:"fetchNeighborhoods",value:function(a){n.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"fetchCuisines",value:function(a){n.fetchRestaurants(function(e,n){if(e)a(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)==t});a(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e){return"/dist/img/"+e.photograph+".jpg"}},{key:"mapMarkerForRestaurant",value:function(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:n.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),n}(),restaurants=void 0,neighborhoods=void 0,cuisines=void 0,markers=[];document.addEventListener("DOMContentLoaded",function(){fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=function(){DBHelper.fetchNeighborhoods(function(e,t){null!=e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})},fillNeighborhoodsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.neighborhoods,n=document.getElementById("neighborhoods-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,t.setAttribute("aria-label",e),t.setAttribute("role","option"),n.append(t)})},fetchCuisines=function(){DBHelper.fetchCuisines(function(e,t){e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})},fillCuisinesHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.cuisines,n=document.getElementById("cuisines-select");e.forEach(function(e){var t=document.createElement("option");t.innerHTML=e,t.value=e,t.setAttribute("aria-label",e),t.setAttribute("role","option"),n.append(t)})},window.initMap=function(){self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()},updateRestaurants=function(){var e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),n=e.selectedIndex,r=t.selectedIndex,a=e[n].value,i=t[r].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,i,function(e,t){e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})},resetRestaurants=function(e){self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(function(e){return e.setMap(null)}),self.markers=[],self.restaurants=e},fillRestaurantsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants,t=document.getElementById("restaurants-list");e.forEach(function(e){t.append(createRestaurantHTML(e))}),addMarkersToMap()},createRestaurantHTML=function(e){var t=document.createElement("li");t.setAttribute("role","listitem"),t.setAttribute("tabindex","0");var n=document.createElement("img");n.className="restaurant-img",n.setAttribute("role","img"),n.src=DBHelper.imageUrlForRestaurant(e);var r=document.createElement("h2");r.innerHTML=e.name,n.setAttribute("aria-label",r.innerHTML+" restaurant"),n.setAttribute("alt",r.innerHTML+" restaurant"),t.append(n),t.append(r);var a=document.createElement("p");a.innerHTML=e.neighborhood,t.append(a);var i=document.createElement("p");i.innerHTML=e.address,t.append(i);var o=document.createElement("a");return o.innerHTML="View Details",o.setAttribute("role","link"),o.href=DBHelper.urlForRestaurant(e),t.append(o),t},addMarkersToMap=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurants).forEach(function(e){var t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",function(){window.location.href=t.url}),self.markers.push(t)})};var restaurant=void 0,map=void 0;window.initMap=function(){fetchRestaurantFromURL(function(e,t){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),document.getElementById("map").setAttribute("role","application"),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})},fetchRestaurantFromURL=function(n){if(self.restaurant)n(null,self.restaurant);else{var e=getParameterByName("id");e?DBHelper.fetchRestaurantById(e,function(e,t){(self.restaurant=t)?(fillRestaurantHTML(),n(null,t)):console.error(e)}):(error="No restaurant id in URL",n(error,null))}},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("restaurant-name");t.innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var n=document.getElementById("restaurant-img");n.className="restaurant-img",n.setAttribute("aria-label",t.innerHTML+" restaurant"),n.setAttribute("alt",t.innerHTML+" restaurant"),n.src=DBHelper.imageUrlForRestaurant(e),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,a.style.color="#525252",r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],i.style.color="#525252",r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),t.appendChild(a)},createReviewHTML=function(e){var t=document.createElement("li");t.setAttribute("tabindex","13"),t.setAttribute("role","listitem");var n=document.createElement("p");n.innerHTML=e.name,n.style.textAlign="left",n.style.width="50%",n.style.order="0",n.style.fontWeight="bold",n.style.fontSize="16px",n.style.color="#932C2A",t.appendChild(n);var r=document.createElement("p");r.innerHTML=e.date,r.style.textAlign="right",r.style.width="50%",r.style.fontSize="16px",r.style.fontStyle="oblique",r.style.textDecoration="underline",r.style.order="0",t.appendChild(r);var a=document.createElement("p");a.innerHTML="Rating: "+e.rating,a.style.backgroundColor="#333333",a.style.borderRadius="5px 5px",a.style.textAlign="center",a.style.fontWeight="bold",a.style.fontSize="17px",a.style.height="25px",a.style.width="100px",a.style.color="#FFB52E",a.style.order="1",t.appendChild(a);var i=document.createElement("p");return i.innerHTML=e.comments,i.style.order="2",i.style.lineHeight="1.6",i.style.textAlign="justify",t.appendChild(i),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyIsInJlc3RhdXJhbnRfaW5mby5qcyJdLCJuYW1lcyI6WyJkYnByb21pc2UiLCJEQkhlbHBlciIsImlkYiIsIm9wZW4iLCJ1cGdyYWRlRGIiLCJjcmVhdGVPYmplY3RTdG9yZSIsImtleVBhdGgiLCJkYXRhIiwib3BlbkRhdGFiYXNlIiwidGhlbiIsImRiIiwidHgiLCJ0cmFuc2FjdGlvbiIsInN0b3JlIiwib2JqZWN0U3RvcmUiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiZ2V0QWxsIiwiZmV0Y2giLCJEQVRBQkFTRV9VUkwiLCJyZXNwb25zZSIsImpzb24iLCJyZXN0YXVyYW50cyIsInNhdmVEYXRhYmFzZSIsImNhbGxiYWNrIiwiZ2V0Q2FjaGVkRGIiLCJsZW5ndGgiLCJQcm9taXNlIiwicmVzb2x2ZSIsImZyb21BcGkiLCJjYXRjaCIsImVyIiwiaWQiLCJmZXRjaFJlc3RhdXJhbnRzIiwiZXJyb3IiLCJmaW5kIiwiciIsImN1aXNpbmUiLCJyZXN1bHRzIiwiZmlsdGVyIiwiY3Vpc2luZV90eXBlIiwibmVpZ2hib3Job29kIiwibmVpZ2hib3Job29kcyIsIm1hcCIsInYiLCJpIiwidW5pcXVlTmVpZ2hib3Job29kcyIsImluZGV4T2YiLCJjdWlzaW5lcyIsInVuaXF1ZUN1aXNpbmVzIiwicGhvdG9ncmFwaCIsImdvb2dsZSIsIm1hcHMiLCJNYXJrZXIiLCJwb3NpdGlvbiIsImxhdGxuZyIsInRpdGxlIiwibmFtZSIsInVybCIsInVybEZvclJlc3RhdXJhbnQiLCJhbmltYXRpb24iLCJBbmltYXRpb24iLCJEUk9QIiwibWFya2VycyIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImZldGNoTmVpZ2hib3Job29kcyIsImZldGNoQ3Vpc2luZXMiLCJjb25zb2xlIiwic2VsZiIsImZpbGxOZWlnaGJvcmhvb2RzSFRNTCIsImFyZ3VtZW50cyIsInVuZGVmaW5lZCIsInNlbGVjdCIsImdldEVsZW1lbnRCeUlkIiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInZhbHVlIiwic2V0QXR0cmlidXRlIiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsIndpbmRvdyIsImluaXRNYXAiLCJNYXAiLCJ6b29tIiwiY2VudGVyIiwibGF0IiwibG5nIiwic2Nyb2xsd2hlZWwiLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInJlc2V0UmVzdGF1cmFudHMiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwibSIsInNldE1hcCIsInVsIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJhZGRNYXJrZXJzVG9NYXAiLCJsaSIsImltYWdlIiwiY2xhc3NOYW1lIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50IiwiYWRkcmVzcyIsIm1vcmUiLCJocmVmIiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImV2ZW50IiwiYWRkTGlzdGVuZXIiLCJsb2NhdGlvbiIsInB1c2giLCJmZXRjaFJlc3RhdXJhbnRGcm9tVVJMIiwiZmlsbEJyZWFkY3J1bWIiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwiZGF5Iiwic3R5bGUiLCJjb2xvciIsImFwcGVuZENoaWxkIiwidGltZSIsInJldmlld3MiLCJjb250YWluZXIiLCJub1Jldmlld3MiLCJyZXZpZXciLCJjcmVhdGVSZXZpZXdIVE1MIiwidGV4dEFsaWduIiwid2lkdGgiLCJvcmRlciIsImZvbnRXZWlnaHQiLCJmb250U2l6ZSIsImRhdGUiLCJmb250U3R5bGUiLCJ0ZXh0RGVjb3JhdGlvbiIsInJhdGluZyIsImJhY2tncm91bmRDb2xvciIsImJvcmRlclJhZGl1cyIsImhlaWdodCIsImNvbW1lbnRzIiwibGluZUhlaWdodCIsImJyZWFkY3J1bWIiLCJyZXBsYWNlIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6IjZYQWlCQSxJQUFJQSxlQUFBQSxFQUNFQywwSEF1QkYsT0FBT0MsSUFBSUMsS0FBSyxlQUFnQixFQUFHLFNBQVNDLEdBQzFDQSxFQUFVQyxrQkFBa0IsZUFBZ0IsQ0FDMUNDLFFBQVMsOENBT0tDLEdBQ2xCLE9BQU9OLEVBQVNPLGVBQWVDLEtBQUssU0FBU0MsR0FDM0MsR0FBS0EsRUFBTCxDQUNBLElBQUlDLEVBQUtELEVBQUdFLFlBQVksZUFBZ0IsYUFDcENDLEVBQVFGLEVBQUdHLFlBQVksZ0JBSTNCLE9BSEFQLEVBQUtRLFFBQVEsU0FBU0MsR0FDcEJILEVBQU1JLElBQUlELEtBRUxMLEVBQUdPLGtEQVNaLE9BREFsQixVQUFZQyxFQUFTTyxnQkFDSkMsS0FBSyxTQUFTQyxHQUM3QixHQUFLQSxFQUdMLE9BRlNBLEVBQUdFLFlBQVksZ0JBQ1RFLFlBQVksZ0JBQ2RLLDZDQUtmLE9BQU9DLE1BQU1uQixFQUFTb0IsY0FDbkJaLEtBQUssU0FBU2EsR0FDYixPQUFPQSxFQUFTQyxTQUNmZCxLQUFLLFNBQUNlLEdBRVAsT0FEQXZCLEVBQVN3QixhQUFhRCxHQUNmQSw2Q0FRV0UsR0E2QnRCLE9BQU96QixFQUFTMEIsY0FBY2xCLEtBQUssU0FBQ2UsR0FDbEMsT0FBSUEsRUFBWUksT0FDUEMsUUFBUUMsUUFBUU4sR0FFaEJ2QixFQUFTOEIsWUFFakJ0QixLQUFLLFNBQUNlLEdBQ0xFLEVBQVMsS0FBTUYsS0FFaEJRLE1BQU0sU0FBQ0MsR0FDTlAsRUFBU08sRUFBSSxvREFTUUMsRUFBSVIsR0FFN0J6QixFQUFTa0MsaUJBQWlCLFNBQUNDLEVBQU9aLEdBQ2hDLEdBQUlZ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bGwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiBlc2xpbnQgXCJyZXF1aXJlLWpzZG9jXCI6IFtcImVycm9yXCIsIHtcbiAgICBcInJlcXVpcmVcIjoge1xuICAgICAgICBcIkZ1bmN0aW9uRGVjbGFyYXRpb25cIjogdHJ1ZSxcbiAgICAgICAgXCJNZXRob2REZWZpbml0aW9uXCI6IGZhbHNlLFxuICAgICAgICBcIkNsYXNzRGVjbGFyYXRpb25cIjogZmFsc2UsXG4gICAgICAgIFwiQXJyb3dGdW5jdGlvbkV4cHJlc3Npb25cIjogZmFsc2UsXG4gICAgICAgIFwiRnVuY3Rpb25FeHByZXNzaW9uXCI6IGZhbHNlXG4gICAgfVxufV0qL1xuLyogZXNsaW50IHZhbGlkLWpzZG9jOiBcImVycm9yXCIqL1xuLyogZXNsaW50IG1heC1sZW46IFtcImVycm9yXCIsIHsgXCJjb2RlXCI6IDEwMCB9XSovXG4vKiBlc2xpbnQgbm8tdW51c2VkLXZhcnM6IFtcImVycm9yXCIsIHsgXCJ2YXJzXCI6IFwibG9jYWxcIiB9XSovXG4vLyBpbXBvcnQgaWRiIGZyb20gXCJpZGJcIjtcblxuLyoqXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cbiAqL1xubGV0IGRicHJvbWlzZTtcbmNsYXNzIERCSGVscGVyIHtcbiAgLyoqXG4gICAqIERhdGFiYXNlIFVSTC5cbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxuICAgKi9cbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XG4gICAgLyoqXG4gICAgKiBjb25zdCBwb3J0ID0gODAwMCAvLyBDaGFuZ2UgdGhpcyB0byB5b3VyIHNlcnZlciBwb3J0XG4gICAgKiByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9kYXRhL3Jlc3RhdXJhbnRzLmpzb25gO1xuICAgICovXG4gICAgY29uc3QgcG9ydCA9IDEzMzc7IC8vIENoYW5nZSB0aGlzIHRvIHlvdXIgc2VydmVyIHBvcnRcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XG4gIH1cblxuICAvKipcbiAgICogQ3JlYXRlIERhdGFiYXNlXG4gICAqL1xuXG4gIHN0YXRpYyBvcGVuRGF0YWJhc2UoKSB7XG4gICAgLy8gaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcil7XG4gICAgLy8gIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAvLyB9XG5cbiAgICByZXR1cm4gaWRiLm9wZW4oJ3Jlc3RhdXJhbnREYicsIDEsIGZ1bmN0aW9uKHVwZ3JhZGVEYikge1xuICAgICAgdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50RGInLCB7XG4gICAgICAgIGtleVBhdGg6ICdpZCd9KTtcbiAgICAgIC8vIHN0b3JlLmNyZWF0ZUluZGV4KCdieS1pZCcsJ2lkJyk7XG4gICAgfSk7XG4gIH1cbiAgLypcbiAgKlNhdmluZyBvbiBkYXRhYmFzZVxuICAqL1xuICBzdGF0aWMgc2F2ZURhdGFiYXNlKGRhdGEpIHtcbiAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbihkYikge1xuICAgICAgaWYgKCFkYikgcmV0dXJuO1xuICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnREYicsICdyZWFkd3JpdGUnKTtcbiAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50RGInKTtcbiAgICAgIGRhdGEuZm9yRWFjaChmdW5jdGlvbihyZXN0YXVyYW50KSB7XG4gICAgICAgIHN0b3JlLnB1dChyZXN0YXVyYW50KTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xuICAgIH0pO1xuICB9XG5cbiAgLypcbiAgKkdldHRpbmcgZGF0YSBmcm9tIERCXG4gICovXG4gIHN0YXRpYyBnZXRDYWNoZWREYigpIHtcbiAgICBkYnByb21pc2UgPSBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKTtcbiAgICByZXR1cm4gZGJwcm9taXNlLnRoZW4oZnVuY3Rpb24oZGIpIHtcbiAgICAgIGlmICghZGIpIHJldHVybjtcbiAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50RGInKTtcbiAgICAgIGxldCBzdG9yZSA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50RGInKTtcbiAgICAgIHJldHVybiBzdG9yZS5nZXRBbGwoKTtcbiAgICB9KTtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tQXBpKCkge1xuICAgIHJldHVybiBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXG4gICAgICAudGhlbihmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xuICAgICAgfSkudGhlbigocmVzdGF1cmFudHMpID0+IHtcbiAgICAgICAgREJIZWxwZXIuc2F2ZURhdGFiYXNlKHJlc3RhdXJhbnRzKTtcbiAgICAgICAgcmV0dXJuIHJlc3RhdXJhbnRzO1xuICAgICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxuICAgKi9cblxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xuICAgIC8qKiBzdGFnZTFcbiAgICAqbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICp4aHIub3BlbignR0VUJywgREJIZWxwZXIuREFUQUJBU0VfVVJMKTtcbiAgICAqeGhyLm9ubG9hZCA9ICgpID0+IHtcbiAgICAqICBpZiAoeGhyLnN0YXR1cyA9PT0gMjAwKSB7IC8vIEdvdCBhIHN1Y2Nlc3MgcmVzcG9uc2UgZnJvbSBzZXJ2ZXIhXG4gICAgKiAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZSh4aHIucmVzcG9uc2VUZXh0KTtcbiAgICAqICAgIGNvbnN0IHJlc3RhdXJhbnRzID0ganNvbi5yZXN0YXVyYW50cztcbiAgICAqICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcbiAgICAqICB9IGVsc2UgeyAvLyBPb3BzIS4gR290IGFuIGVycm9yIGZyb20gc2VydmVyLlxuICAgICogICAgY29uc3QgZXJyb3IgPSAoYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCBzdGF0dXMgb2YgJHt4aHIuc3RhdHVzfWApO1xuICAgICogICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICogIH1cbiAgICAqfTtcbiAgICAqeGhyLnNlbmQoKTtcbiAgICAqKi9cblxuICAgLyoqIFRlc3RpbmcgZmV0Y2ggZnJvbSBkdW1teSBzZXJ2ZXJcbiAgICAqZmV0Y2goREJIZWxwZXIuREFUQUJBU0VfVVJMKVxuICAgICogIC50aGVuKHJlc3BvbmQgPT4ge1xuICAgICogICAgaWYgKCFyZXNwb25kLm9rKXtcbiAgICAqICAgICAgdGhyb3cgXCJVbmFibGUgdG8gZmV0Y2ggZnJvbSBzZXJ2ZXIhXCI7XG4gICAgKiAgICB9XG4gICAgKiAgICByZXR1cm4gcmVzcG9uZC5qc29uKCk7XG4gICAgKiAgfSlcbiAgICAqICAudGhlbihyZXN0YXVyYW50cyA9PiBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cykpXG4gICAgKiAgLmNhdGNoKGUgPT4gY2FsbGJhY2soZSxudWxsKSlcbiAgICAqKi9cblxuICAgIHJldHVybiBEQkhlbHBlci5nZXRDYWNoZWREYigpLnRoZW4oKHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAocmVzdGF1cmFudHMubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdGF1cmFudHMpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIERCSGVscGVyLmZyb21BcGkoKTtcbiAgICAgIH1cbiAgICB9KS50aGVuKChyZXN0YXVyYW50cykgPT4ge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcikgPT4ge1xuICAgICAgICBjYWxsYmFjayhlciwgbnVsbCk7XG4gICAgICB9KTtcbiAgICB9XG5cblxuICAvKipcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cbiAgICovXG5cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKChyKSA9PiByLmlkID09IGlkKTtcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHsgLy8gR290IHRoZSByZXN0YXVyYW50XG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XG4gICAgICAgIH0gZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cblxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIoKHIpID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cbiAgICovXG5cbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKChyKSA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cblxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcigocikgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKChyKSA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xuICAgICAgICB9XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cblxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZCk7XG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKTtcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxuICAgKi9cblxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSk7XG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxuICAgKi9cblxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxuICAgKi9cblxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcbiAgICAvLyByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofWBcbiAgICByZXR1cm4gKGAvZGlzdC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LmpwZ2ApO1xuICB9XG5cbiAgLyoqXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cbiAgICovXG5cbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxuICAgICAgbWFwOiBtYXAsXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QfVxuICAgICk7XG4gICAgcmV0dXJuIG1hcmtlcjtcbiAgfVxufVxuIiwiLyogZXNsaW50IG1heC1sZW46IFtcImVycm9yXCIsIHsgXCJjb2RlXCI6IDEwMCB9XSovXG4vKiBlc2xpbnQgbm8tdW51c2VkLXZhcnM6IFtcImVycm9yXCIsIHsgXCJ2YXJzXCI6IFwibG9jYWxcIiB9XSovXG5cbmxldCByZXN0YXVyYW50cztcbmxldCBuZWlnaGJvcmhvb2RzO1xubGV0IGN1aXNpbmVzO1xudmFyIG1hcDtcbnZhciBtYXJrZXJzID0gW107XG5cbi8qKlxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXG4gKi9cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCAoKSA9PiB7XG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xuICBmZXRjaEN1aXNpbmVzKCk7XG59KTtcblxuLyoqXG4gKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cbmZldGNoTmVpZ2hib3Job29kcyA9ICgpID0+IHtcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xuICAgIGlmIChlcnJvciAhPSBudWxsKSB7IC8vIEdvdCBhbiBlcnJvclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBTZXQgbmVpZ2hib3Job29kcyBIVE1MLlxuICovXG5cbmZpbGxOZWlnaGJvcmhvb2RzSFRNTCA9IChuZWlnaGJvcmhvb2RzID0gc2VsZi5uZWlnaGJvcmhvb2RzKSA9PiB7XG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuICBuZWlnaGJvcmhvb2RzLmZvckVhY2goKG5laWdoYm9yaG9vZCkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgIG9wdGlvbi5pbm5lckhUTUwgPSBuZWlnaGJvcmhvb2Q7XG4gICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBuZWlnaGJvcmhvb2QpO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnb3B0aW9uJyk7XG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xuICAgIC8vIHNlbGVjdFswXS5zZXRBdHRyaWJ1dGUoJ2xhYmVsJyxzZWxlY3RbMF0uaW5uZXJIVE1MKTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIEZldGNoIGFsbCBjdWlzaW5lcyBhbmQgc2V0IHRoZWlyIEhUTUwuXG4gKi9cblxuZmV0Y2hDdWlzaW5lcyA9ICgpID0+IHtcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICBzZWxmLmN1aXNpbmVzID0gY3Vpc2luZXM7XG4gICAgICBmaWxsQ3Vpc2luZXNIVE1MKCk7XG4gICAgfVxuICB9KTtcbn07XG5cbi8qKlxuICogU2V0IGN1aXNpbmVzIEhUTUwuXG4gKi9cblxuZmlsbEN1aXNpbmVzSFRNTCA9IChjdWlzaW5lcyA9IHNlbGYuY3Vpc2luZXMpID0+IHtcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xuXG4gIGN1aXNpbmVzLmZvckVhY2goKGN1aXNpbmUpID0+IHtcbiAgICBjb25zdCBvcHRpb24gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdvcHRpb24nKTtcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xuICAgIG9wdGlvbi5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBjdWlzaW5lKTtcbiAgICBvcHRpb24uc2V0QXR0cmlidXRlKCdyb2xlJywgJ29wdGlvbicpO1xuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcbiAgfSk7XG59O1xuXG4vKipcbiAqIEluaXRpYWxpemUgR29vZ2xlIG1hcCwgY2FsbGVkIGZyb20gSFRNTC5cbiAqL1xuXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcbiAgbGV0IGxvYyA9IHtcbiAgICBsYXQ6IDQwLjcyMjIxNixcbiAgICBsbmc6IC03My45ODc1MDEsXG4gIH07XG5cbiAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgIHpvb206IDEyLFxuICAgIGNlbnRlcjogbG9jLFxuICAgIHNjcm9sbHdoZWVsOiBmYWxzZSxcbiAgfSk7XG5cbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcbn07XG5cbi8qKlxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cbiAqL1xuXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcbiAgY29uc3QgY1NlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcbiAgY29uc3QgblNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xuXG4gIGNvbnN0IGNJbmRleCA9IGNTZWxlY3Quc2VsZWN0ZWRJbmRleDtcbiAgY29uc3QgbkluZGV4ID0gblNlbGVjdC5zZWxlY3RlZEluZGV4O1xuXG4gIGNvbnN0IGN1aXNpbmUgPSBjU2VsZWN0W2NJbmRleF0udmFsdWU7XG5cbiAgLy8gY1NlbGVjdFswXS5zZXRBdHRyaWJ1dGUoJ2xhYmVsJyxjU2VsZWN0WzBdLmlubmVySFRNTCk7XG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IG5TZWxlY3RbbkluZGV4XS52YWx1ZTtcblxuICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCAoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXNldFJlc3RhdXJhbnRzKHJlc3RhdXJhbnRzKTtcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBDbGVhciBjdXJyZW50IHJlc3RhdXJhbnRzLCB0aGVpciBIVE1MIGFuZCByZW1vdmUgdGhlaXIgbWFwIG1hcmtlcnMuXG4gKi9cblxucmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xuICAvLyBSZW1vdmUgYWxsIHJlc3RhdXJhbnRzXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICB1bC5pbm5lckhUTUwgPSAnJztcblxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXG4gIHNlbGYubWFya2Vycy5mb3JFYWNoKChtKSA9PiBtLnNldE1hcChudWxsKSk7XG4gIHNlbGYubWFya2VycyA9IFtdO1xuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhbGwgcmVzdGF1cmFudHMgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXG4gKi9cblxuZmlsbFJlc3RhdXJhbnRzSFRNTCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xuICByZXN0YXVyYW50cy5mb3JFYWNoKChyZXN0YXVyYW50KSA9PiB7XG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcbiAgfSk7XG4gIGFkZE1hcmtlcnNUb01hcCgpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBIVE1MLlxuICovXG5cbmNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQpID0+IHtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5zZXRBdHRyaWJ1dGUoJ3JvbGUnLCAnbGlzdGl0ZW0nKTtcbiAgbGkuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XG5cbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJztcbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2ltZycpO1xuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuICAvKiB1bmlxdWUgYWx0IGZvciB0aGUgaW1hZ2UgKi9cbiAgaW1hZ2Uuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgbmFtZS5pbm5lckhUTUwrJyByZXN0YXVyYW50Jyk7XG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnYWx0JywgbmFtZS5pbm5lckhUTUwrJyByZXN0YXVyYW50Jyk7XG5cbiAgbGkuYXBwZW5kKGltYWdlKTtcbiAgbGkuYXBwZW5kKG5hbWUpO1xuXG4gIGNvbnN0IG5laWdoYm9yaG9vZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcblxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcbiAgbGkuYXBwZW5kKGFkZHJlc3MpO1xuXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XG4gIG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgRGV0YWlscyc7XG4gIG1vcmUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xpbmsnKTtcblxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xuICBsaS5hcHBlbmQobW9yZSk7XG5cbiAgcmV0dXJuIGxpO1xufTtcblxuLyoqXG4gKiBBZGQgbWFya2VycyBmb3IgY3VycmVudCByZXN0YXVyYW50cyB0byB0aGUgbWFwLlxuICovXG5cbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcbiAgcmVzdGF1cmFudHMuZm9yRWFjaCgocmVzdGF1cmFudCkgPT4ge1xuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxuICAgIGNvbnN0IG1hcmtlciA9IERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgc2VsZi5tYXApO1xuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsO1xuICAgIH0pO1xuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XG4gIH0pO1xufTtcbiIsIi8qIGVzbGludCBtYXgtbGVuOiBbXCJlcnJvclwiLCB7IFwiY29kZVwiOiAxMDAgfV0qL1xuLyogZXNsaW50IG5vLXVudXNlZC12YXJzOiBbXCJlcnJvclwiLCB7IFwidmFyc1wiOiBcImxvY2FsXCIgfV0qL1xuXG5cbmxldCByZXN0YXVyYW50O1xubGV0IG1hcDtcblxuLyoqXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXG4gKi9cbndpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcbiAgICB9IGVsc2Uge1xuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xuICAgICAgICB6b29tOiAxNixcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlLFxuICAgICAgfSk7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJykuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2FwcGxpY2F0aW9uJyk7XG5cbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XG5cbiAgICAgIC8qXG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJykuc2V0QXR0cmlidXRlKCdyb2xlJywnYXBwbGljYXRpb24nKTtcbiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKS5zZXRBdHRyaWJ1dGUoJ3RhYmluZGV4JywnNCcpO1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLnNldEF0dHJpYnV0ZSgnYXJpYS1oaWRkZW4nLCd0cnVlJyk7XG4gICAgICAqL1xuICAgICAgREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChzZWxmLnJlc3RhdXJhbnQsIHNlbGYubWFwKTtcbiAgICB9XG4gIH0pO1xufTtcblxuLyoqXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXG4gKi9cblxuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xuICBpZiAoc2VsZi5yZXN0YXVyYW50KSB7IC8vIHJlc3RhdXJhbnQgYWxyZWFkeSBmZXRjaGVkIVxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudCk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xuICBpZiAoIWlkKSB7IC8vIG5vIGlkIGZvdW5kIGluIFVSTFxuICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJztcbiAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XG4gIH0gZWxzZSB7XG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XG4gICAgICBzZWxmLnJlc3RhdXJhbnQgPSByZXN0YXVyYW50O1xuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xuICAgIH0pO1xuICB9XG59O1xuXG4vKipcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxuICovXG5cbmZpbGxSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50ID0gc2VsZi5yZXN0YXVyYW50KSA9PiB7XG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xuXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xuXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XG4gIC8qIHVuaXF1ZSBhbHQtYXJpYWxhYmVsICovXG4gIGltYWdlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIG5hbWUuaW5uZXJIVE1MKycgcmVzdGF1cmFudCcpO1xuICBpbWFnZS5zZXRBdHRyaWJ1dGUoJ2FsdCcsIG5hbWUuaW5uZXJIVE1MKycgcmVzdGF1cmFudCcpO1xuXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcblxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xuXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XG4gIH1cbiAgLy8gZmlsbCByZXZpZXdzXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxuICovXG5cbmZpbGxSZXN0YXVyYW50SG91cnNIVE1MID0gKG9wZXJhdGluZ0hvdXJzID0gc2VsZi5yZXN0YXVyYW50Lm9wZXJhdGluZ19ob3VycykgPT4ge1xuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xuICAgIGNvbnN0IHJvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7XG5cbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIGRheS5pbm5lckhUTUwgPSBrZXk7XG4gICAgZGF5LnN0eWxlLmNvbG9yPScjNTI1MjUyJztcbiAgICByb3cuYXBwZW5kQ2hpbGQoZGF5KTtcblxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xuICAgIHRpbWUuaW5uZXJIVE1MID0gb3BlcmF0aW5nSG91cnNba2V5XTtcbiAgICB0aW1lLnN0eWxlLmNvbG9yPScjNTI1MjUyJztcblxuICAgIHJvdy5hcHBlbmRDaGlsZCh0aW1lKTtcblxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XG4gIH1cbn07XG5cbi8qKlxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxuICovXG5cbmZpbGxSZXZpZXdzSFRNTCA9IChyZXZpZXdzID0gc2VsZi5yZXN0YXVyYW50LnJldmlld3MpID0+IHtcbiAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XG4gIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcbiAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodGl0bGUpO1xuXG4gIGlmICghcmV2aWV3cykge1xuICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XG4gICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xuICByZXZpZXdzLmZvckVhY2goKHJldmlldykgPT4ge1xuICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XG4gIH0pO1xuICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cbiAqL1xuXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gIC8qIHNjcmVlbmVyIHNldHRpbmdzICovXG4gIGxpLnNldEF0dHJpYnV0ZSgndGFiaW5kZXgnLCAnMTMnKTtcbiAgbGkuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2xpc3RpdGVtJyk7XG5cbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcbiAgbmFtZS5zdHlsZS50ZXh0QWxpZ249J2xlZnQnO1xuICBuYW1lLnN0eWxlLndpZHRoPSc1MCUnO1xuICBuYW1lLnN0eWxlLm9yZGVyPScwJztcbiAgbmFtZS5zdHlsZS5mb250V2VpZ2h0PSdib2xkJztcbiAgbmFtZS5zdHlsZS5mb250U2l6ZT0nMTZweCc7XG4gIG5hbWUuc3R5bGUuY29sb3I9JyM5MzJDMkEnO1xuXG5cbiAgbGkuYXBwZW5kQ2hpbGQobmFtZSk7XG5cbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcbiAgZGF0ZS5pbm5lckhUTUwgPSByZXZpZXcuZGF0ZTtcbiAgZGF0ZS5zdHlsZS50ZXh0QWxpZ249J3JpZ2h0JztcbiAgZGF0ZS5zdHlsZS53aWR0aD0nNTAlJztcbiAgZGF0ZS5zdHlsZS5mb250U2l6ZT0nMTZweCc7XG4gIGRhdGUuc3R5bGUuZm9udFN0eWxlPSdvYmxpcXVlJztcbiAgZGF0ZS5zdHlsZS50ZXh0RGVjb3JhdGlvbj0ndW5kZXJsaW5lJztcbiAgZGF0ZS5zdHlsZS5vcmRlcj0nMCc7XG5cbiAgbGkuYXBwZW5kQ2hpbGQoZGF0ZSk7XG5cbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xuICByYXRpbmcuaW5uZXJIVE1MID0gYFJhdGluZzogJHtyZXZpZXcucmF0aW5nfWA7XG4gIC8qIFJhdGluZyBzZXR0aW5ncyAqL1xuICByYXRpbmcuc3R5bGUuYmFja2dyb3VuZENvbG9yPScjMzMzMzMzJztcbiAgcmF0aW5nLnN0eWxlLmJvcmRlclJhZGl1cz0nNXB4IDVweCc7XG4gIHJhdGluZy5zdHlsZS50ZXh0QWxpZ249J2NlbnRlcic7XG4gIHJhdGluZy5zdHlsZS5mb250V2VpZ2h0PSdib2xkJztcbiAgcmF0aW5nLnN0eWxlLmZvbnRTaXplPScxN3B4JztcbiAgcmF0aW5nLnN0eWxlLmhlaWdodD0nMjVweCc7XG4gIHJhdGluZy5zdHlsZS53aWR0aD0nMTAwcHgnO1xuICByYXRpbmcuc3R5bGUuY29sb3I9JyNGRkI1MkUnO1xuICByYXRpbmcuc3R5bGUub3JkZXI9JzEnO1xuXG4gIGxpLmFwcGVuZENoaWxkKHJhdGluZyk7XG5cbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XG4gIGNvbW1lbnRzLmlubmVySFRNTCA9IHJldmlldy5jb21tZW50cztcbiAgY29tbWVudHMuc3R5bGUub3JkZXI9JzInO1xuICBjb21tZW50cy5zdHlsZS5saW5lSGVpZ2h0PScxLjYnO1xuICBjb21tZW50cy5zdHlsZS50ZXh0QWxpZ249J2p1c3RpZnknO1xuXG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcblxuXG4gIHJldHVybiBsaTtcbn07XG5cbi8qKlxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcbiAqL1xuXG5maWxsQnJlYWRjcnVtYiA9IChyZXN0YXVyYW50PXNlbGYucmVzdGF1cmFudCkgPT4ge1xuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xufTtcblxuLyoqXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxuICovXG5cbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcbiAgaWYgKCF1cmwpIHtcbnVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xufVxuICBuYW1lID0gbmFtZS5yZXBsYWNlKC9bXFxbXFxdXS9nLCAnXFxcXCQmJyk7XG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApO1xuICBjb25zdCByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpO1xuICBpZiAoIXJlc3VsdHMpIHtcbnJldHVybiBudWxsO1xufVxuICBpZiAoIXJlc3VsdHNbMl0pIHtcbnJldHVybiAnJztcbn1cbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcbn07XG5cblxuLypcblNjcmVlbiBSZWFkZXIgU0VUVElOR1MgZm9yIHRoZSByZXZpZXdzXG4qL1xuIl19
